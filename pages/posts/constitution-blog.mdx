import PostLayout from "@/components/posts/PostLayout"

export const meta = {
  title: 'Next.js + MDX ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸãƒ–ãƒ­ã‚°ã®é‹ç”¨æ–¹æ³•',
  createdAt: '2022-06-16',
  emoji: 'ğŸš§ ',
}

# Next.js + MDX ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ãŸãƒ–ãƒ­ã‚°ã®æ§‹æˆ

## Next.jsã®SGã‚’æœ€å¤§é™ã«æ´»ç”¨ã™ã‚‹(ä¸€è¦§ãƒšãƒ¼ã‚¸ã‚’ä½œã‚‹)

Next.jsã®åˆ©ç‚¹ã®ä¸€ã¤ã«ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚ãƒ“ãƒ«ãƒ‰æ™‚ã‚‚ã—ãã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã«HTML, CSSã¨ã„ã£ãŸé™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚

ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ä¿æœ‰ã—ã¦ã„ã‚‹èªè¨¼æƒ…å ±ãŒä½¿ãˆã‚‹ãªã©ã®åˆ©ç‚¹ãŒã‚ã‚Šã¾ã™ãŒã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ãƒã‚·ãƒ³ã‚¹ãƒšãƒƒã‚¯ã«ä¾å­˜ã—ã¦ã—ã¾ã£ãŸã‚Šã€ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ãŒãƒšãƒ¼ã‚¸ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’èªè­˜ã—ãªã„ãŸã‚SEOã«å¼±ã„ã¨ã„ã†æ¬ ç‚¹ãŒã‚ã‚Šã¾ã™ã€‚ä¸€æ–¹ã€ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ç”¨ã„ã‚‹ã¨ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚„SEOã«å¼·ã„Webã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚  
å®Ÿéš›ã«ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’ä½¿ã†ã¨ã€å¤§æŠµã®å ´åˆlighthouseã®ã‚¹ã‚³ã‚¢ãŒé¡•è‘—ã«ä¸Šæ˜‡ã—ã¾ã™ã€‚

Next.jsã§SGã‚’ä½¿ã†ã«ã¯ã€getStaticPropsã¨ã„ã†é–¢æ•°ã‚’exportã—ã¾ã™ã€‚ãã†ã™ã‚‹ã“ã¨ã§ãƒšãƒ¼ã‚¸ã‚‚ã—ãã¯ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãŒãƒ“ãƒ«ãƒ‰æ™‚ã«ç”Ÿæˆã•ã‚Œã¾ã™ã€‚  
getAllPostã®å†…éƒ¨ã§ã¯ã€æ‹¡å¼µå­ãŒ.mdxã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰exportã•ã‚Œã¦ã„ã‚‹è¨˜äº‹ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ã™ã¹ã¦å–å¾—ã—ã¦ãƒªã‚¹ãƒˆã¨ã—ã¦è¿”ã—ã¦ã„ã¾ã™ã€‚

```ts
import { getAllPost } from "@/lib/getAllPost"

export const getStaticProps = async () => {
  return {
    props: {
      posts: await getAllPost(),
    },
  };
}
```

## Tailwind CSS ã§ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚ã¦ã‚‹

æ­£ç¢ºã«ã¯ @taiwindcss/typography ã¨ã„ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ç”¨ã„ã¦ã„ã¾ã™ã€‚

ã¾ãšã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚

```
yarn add @tailwindcss/typography
```

ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒçµ‚ã‚ã‚Šæ¬¡ç¬¬ã€tailwindcss.config.js ã«ä¸‹è¨˜ã®ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã§ä½¿ç”¨ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```js
module.exports = {
  ...
  plugins: [require("@tailwindcss/typography")],
}
```

className="prose" ã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’ã‚ã¦ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```tsx
const Post = ({ children }: { children: ReactChildren }) => {
  return (
    <article className="prose">
      { children }
    </article>
  )
}
```

## Cloud Run ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è‡ªå‹•åŒ–ã™ã‚‹

ã¾ãšã“ã®ãƒ–ãƒ­ã‚°ã¯ Cloud Run ã§å‹•ã‹ã—ã¦ã„ã‚‹ã®ã§ã™ãŒã€Vercel ã¨åŒæ§˜ã« main ãƒ–ãƒ©ãƒ³ãƒã«ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã€è‡ªå‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã‚ˆã†ã«ã—ãŸæ–¹ãŒé–‹ç™ºä½“é¨“ãŒå‘ä¸Šã™ã‚‹ã¨æ€ã„ã¾ã™ã€‚

äº‹å‰æº–å‚™ã¨ã—ã¦ã€GCP ã§ã‚µãƒ¼ãƒ“ã‚¹ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã€éµã‚’ç”Ÿæˆã—ã¾ã™ã€‚ãã‚Œã‚’ base64 ã§æš—å·åŒ–ã—ã€ãã‚Œã‚’ GitHub ã® Repository Secrets ã«ç™»éŒ²ã—ã¾ã™ã€‚

```
cat credential.json | base64 | pbcopy
```

ã“ã‚Œã‚’ .github/workflows/*.yml ã‹ã‚‰å‚ç…§ã—ã¦ Google Cloud CLI ã‚’èªè¨¼ã—ã€Cloud Run ã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’è¡Œã„ã¾ã™ã€‚

```yaml
- name: auth
  uses: google-github-actions/auth@v0
  with:
    credentials_json: ${{ secrets.GCP_CREDENTIALS }}
```

export default ({ children }) => <PostLayout meta={meta}>{children}</PostLayout>
