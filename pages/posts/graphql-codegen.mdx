import PostLayout from "@/components/posts/PostLayout"
import TwitterButton from "@/components/posts/TwitterButton"

export const meta = {
  title: 'GraphQL Code Generator ã§ Query / Mutation ã® Hooks ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹',
  createdAt: '2022-07-05',
  emoji: 'ğŸ§¬ ',
}

# GraphQL Code Generator ã§ Query / Mutation ã® Hooks ã‚’è‡ªå‹•ç”Ÿæˆã™ã‚‹

**ğŸ“ Point**
1. CSR ã¨ SSR/SG/ISR ã§ä½¿ã„åˆ†ã‘ã‚‹
2. .envãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€

## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

CSR ã‹ SSR/SG/ISR ã«é–¢ã‚ã‚‰ãšä½¿ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```shell
yarn add graphql
yarn add -D @graphql-codegen/cli @graphql-codegen/typescript @graphql-codegen/typescript-operations @graphql-codegen/near-operation-file-preset
```

CSR ã®å ´åˆã«ç”¨ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```shell
yarn add @apollo/client
yarn add -D @graphql-codegen/typescript-react-apollo
```

SSR/SG/ISR ã®å ´åˆã«ç”¨ã„ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

```shell
yarn add graphql-request
yarn add -D @graphql-codegen/typescript-graphql-request @graphql-codegen/import-types-preset
```

## è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ

`.env` ã« GraphQL ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å…¥ã‚Œã¾ã™ã€‚

```
GRAPHQL_ENDPOINT=<<YOUR_GRAPHQL_ENDPOINT>>
```

ãƒ«ãƒ¼ãƒˆç›´ä¸‹ã« `codegen.yml` ã‚’ä½œæˆã—ã¾ã™ã€‚

```yaml
overwrite: true
schema: ${GRAPHQL_ENDPOINT}
documents: "src/graphql/**/*.graphql"
generates:
  src/graphql/types.ts:
    plugins:
      - "typescript"
  src/graphql/:
    preset: near-operation-file
    presetConfig:
      extension: .generated.tsx
      baseTypesPath: types.ts
    plugins:
      - "typescript-operations"
      - "typescript-react-apollo"
  # ä¸‹è¨˜ã¯SSR/SG/ISRã‚’ä½¿ã†å ´åˆã®ã¿
  src/graphql/ssr.generated.ts:
    preset: import-types
    presetConfig:
      typesPath: "./types"
    plugins:
      - "typescript-operations"
      - "typescript-graphql-request"
```

`package.json` ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚  
`--require dotenv/config` ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§ã€`.env` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§ã§ãã¾ã™ã€‚

```json
{
  ...,
  "scripts": {
    ...,
    "codegen": "graphql-codegen --require dotenv/config"
  },
}
```

## GraphQL ã®ã‚¯ã‚¨ãƒªã‚’ä½œæˆ

`src/**/*.graphql` ã‚’ä½œæˆã—ã¾ã™ã€‚

```graphql
query getUser($id: ID!) {
  user(id: $id) {
      id
      name
    }
}
```

## å®Ÿè¡Œ

ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€`src/**/*.graphql` ã® Query ã‚‚ã—ãã¯ Mutation ã®Hooksã‚’è‡ªå‹•ç”Ÿæˆã—ã¦ãã‚Œã¾ã™ã€‚  
å‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚åŒæ™‚ã«è‡ªå‹•ç”Ÿæˆã—ã¦ãã‚Œã‚‹ã®ã§ã€GraphQL ã®APIé€šä¿¡ãŒã‹ãªã‚Šå¿«é©ã«ãªã‚Šã¾ã™ã€‚

```shell
yarn codegen
```

## ãŠã‚ã‚Šã«

ã”è³ªå•ãƒ»ã”æ„è¦‹ç­‰ã¯ä¸‹è¨˜ã®Twitterã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚

<TwitterButton />

export default ({ children }) => <PostLayout meta={meta}>{children}</PostLayout>
